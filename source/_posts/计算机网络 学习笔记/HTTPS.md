---
title: HTTPS
date: 1588246722882.7183
tags:
- 计算机网络
category:
- 计算机网络
---
# 目录

### [**1. HTTP基本原理**](#jumpa)

- ##### [**基本概念**](#jump1)

- ##### [**HTTPS 优缺点**](#jump2)

### [**2. 加密**](#jumpb)

- ##### [**共享密钥加密**](#jump3)

- ##### [**公开密钥加密**](#jump4)

- ##### [**HTTPS采用混合加密机制**](#jump5)

### [**3. 证书**](#jumpc)

- ##### [**数字证书**](#jump6)

- ##### [**EV SSL 证书**](#jump7)

- ##### [**客户端证书**](#jump8)

- ##### [**自签名证书**](#jump9)

### [**4. HTTPS的安全通信机制**](#jumpd)

- ##### [**HTTPS 通信过程**](#jump10)

  - [**具体版 通信过程**](#jump10)
  - [**简要版 通信过程**](#jump11)
  - [**不一直使用 HTTPS的原因**](#jump12)

- ##### [**SSL 和 TLS**](#jump13)

  - [**SSL握手过程**](#jump13)
  - [**SSL速度慢的原因**](#jump14)

### [**5. HTTP 和 HTTPS的区别**](#jumpe)



# <span id="jumpa">**（一）HTTP基本原理**</span>

### <span id="jump1">**1. 基本概念**</span>

**HTTP+ 加密 + 认证 + 完整性保护=HTTPS**

即：HTTP 加上加密处理和认证以及完整性保护后即是HTTPS
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200501105210851.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjEyNDIxNA==,size_16,color_FFFFFF,t_70)


HTTPS 并非是应用层的一种新协议。只是 HTTP 通信接口部分用SSL（Secure Socket Layer）和TLS（Transport Layer Security）协议代替而已。通常，HTTP 直接和 TCP 通信。当使用 SSL时，则演变成先和 SSL通信，再由 SSL和 TCP 通信了。简言之，所谓 HTTPS，其实就是身披SSL协议这层外壳的 HTTP。HTTPS的SSL加密是在传输层实现的。在采用 SSL后，HTTP 就拥有了 HTTPS 的加密、证书和完整性保护这些功能。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200501105239227.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjEyNDIxNA==,size_16,color_FFFFFF,t_70)


SSL是独立于 HTTP 的协议，所以不光是 HTTP 协议，其他运行在应用层的 SMTP 和 Telnet 等协议均可配合 SSL协议使用。可以说 SSL是当今世界上应用最为广泛的网络安全。SSL采用一种叫做公开密钥加密（Public-key cryptography）的加密处理方式。

### <span id="jump2">**2. HTTPS优缺点**</span>

**优点**：

- 使用HTTPS协议可认证用户和服务器，确保数据发送到正确的客户机和服务器；
- HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，要比http协议安全，可防止数据在传输过程中不被窃取、改变，确保数据的完整性。
- HTTPS是现行架构下最安全的解决方案，虽然不是绝对安全，但它大幅增加了中间人攻击的成本。

**缺点**：

- https握手阶段比较费时，会使页面加载时间延长50%，增加10%~20%的耗电。
- https缓存不如http高效，会增加数据开销。
- SSL证书也需要钱，功能越强大的证书费用越高。
- SSL证书需要绑定IP，不能再同一个ip上绑定多个域名，ipv4资源支持不了这种消耗。

# <span id="jumpb">**（二）加密**</span>

近代的加密方法中加密算法是公开的，而密钥却是保密的。通过这种方式得以保持加密方法的安全性。加密和解密都会用到密钥。没有密钥就无法对密码解密，反过来说，任何人只要持有密钥就能解密了。如果密钥被攻击者获得，那加密也就失去了意义。

### <span id="jump3">**1. 共享密钥加密**</span>

共享密钥加密：又叫做 私钥加密 或 对称加密，即信息的发送方和接收方使用同一个密钥去加密和解密数据。对称加密的特点是算法公开、加密和解密速度快，适合于对大数据量进行加密。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200501105329323.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjEyNDIxNA==,size_16,color_FFFFFF,t_70)

共享密钥加密中用到的密钥叫做私钥，私钥表示个人私有的密钥，即该密钥不能被泄露。

**共享密钥加密过程**

- 加密过程：**明文 + 加密算法 + 私钥 => 密文**
- 解密过程：**密文 + 解密算法 + 私钥 => 明文**

由于共享密钥加密的算法是公开的，所以一旦私钥被泄露，那么密文就很容易被破解，所以共享密钥加密的缺点是密钥安全管理困难。以共享密钥方式加密时必须将密钥也发给对方。可究竟怎样才能安全地转交？在互联网上转发密钥时，如果通信被监听那么密钥就可会落入攻击者之手，同时也就失去了加密的意义。另外还得设法安全地保管接收到的密钥。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200501105403543.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjEyNDIxNA==,size_16,color_FFFFFF,t_70)


于是引出下面要说的 **公开密钥加密**，公开密钥加密方式很好地解决了共享密钥加密的困难。

### <span id="jump4">**2. 公开密钥加密**</span>

公开密钥加密：也叫做公钥加密 或 非对称加密。非对称加密与对称加密相比，其安全性更好。

非对称加密使用一对密钥，即公钥和私钥，且二者成对出现。私钥被自己保存，不能对外泄露。公钥指的是公共的密钥，任何人都可以获得该密钥。用公钥或私钥中的任何一个进行加密，用另一个进行解密。

使用公开密钥加密方式，发送密文的一方使用对方的公开密钥进行加密处理，对方收到被加密的信息后，再使用自己的私有密钥进行解密。利用这种方式，不需要发送用来解密的私有密钥，也不必担心密钥被攻击者窃听而盗走。另外，要想根据密文和公开密钥，恢复到信息原文是异常困难的，因为解密过程就是在对离散对数进行求值，这并非轻而易举就能办到。退一步讲，如果能对一个非常大的整数做到快速地因式分解，那么密码破解还是存在希望的。但就目前的技术来看是不太现实。

**公开密钥加密过程**：

- 被公钥加密过的密文只能被私钥解密，过程如下：

  **明文 + 加密算法 + 公钥 => 密文， 密文 + 解密算法 + 私钥 => 明文**

- 被私钥加密过的密文只能被公钥解密，过程如下：
  **明文 + 加密算法 + 私钥 => 密文， 密文 + 解密算法 + 公钥 => 明文**

由于加密和解密使用了两个不同的密钥，这就是非对称加密“非对称”的原因。
非对称加密的缺点是加密和解密花费时间长、速度慢，只适合对少量数据进行加密。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200501105447466.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjEyNDIxNA==,size_16,color_FFFFFF,t_70)

### <span id="jump5">**3. HTTPS采用混合加密机制**</span>

HTTPS 采用共享密钥加密和公开密钥加密两者并用的混合加密机制。若密钥能够实现安全交换，那么有可能会考虑仅使用公开密钥加密来通信。但是公开密钥加密与共享密钥加密相比，其处理速度要慢。所以应充分利用两者各自的优势，将多种方法组合起来用于通信。在交换密钥环节使用公开密钥加密方式，之后的建立通信交换报文阶段则使用共享密钥加密方。

**混合加密机制**：
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200501105511140.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjEyNDIxNA==,size_16,color_FFFFFF,t_70)


HTTPS 在内容传输的加密上使用的是对称加密，非对称加密只作用在证书验证阶段。

# <span id="jumpc">**（三）证书**</span>

### <span id="jump6">**1. 证明公开密钥正确性的数字证书**</span>

遗憾的是，公开密钥加密方式还是存在一些问题的。那就是无法证明公开密钥本身就是货真价实的公开密钥。比如，正准备和某台服务器建立公开密钥加密方式下的通信时，如何证明收到的公开密钥就是原本预想的那台服务器发行的公开密钥。或许在公开密钥传输途中，真正的公开密钥已经被攻击者替换掉了。

为了解决上述问题，可以使用由**数字证书认证机构**（CA，CertificateAuthority）和其相关机关颁发的公开密钥证书。数字证书认证机构处于客户端与服务器双方都可信赖的第三方机构的立场上。

**数字证书认证机构的业务流程**

- 首先，服务器的运营人员向数字证书认证机构提出公开密钥的申请。
- 数字证书认证机构在判明提出申请者的身份之后，会对已申请的公开密钥做数字签名，然后分配这个已签名的公开密钥，并将该公开密钥放入公钥证书后绑定在一起。
- 服务器会将这份由数字证书认证机构颁发的公钥证书发送给客户端，以进行公开密钥加密方式通信。公钥证书也可叫做**数字证书**或直接称为**证书**。

- 接到证书的客户端可使用数字证书认证机构的公开密钥，对那张证书上的数字签名进行验证，一旦验证通过，客户端便可明确两件事：一，认证服务器的公开密钥的是真实有效的数字证书认证机构。二，服务器的公开密钥是值得信赖。

此处认证机关的公开密钥必须安全地转交给客户端。使用通信方式时，如何安全转交是一件很困难的事，因此，多数浏览器开发商发布版本时，会事先在内部植入常用认证机关的公开密钥。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200501105601584.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjEyNDIxNA==,size_16,color_FFFFFF,t_70)

### <span id="jump7">**2.  可证明组织真实性的 EV SSL 证书**<span>

证书的一个作用是用来证明作为通信一方的服务器是否规范，另外一个作用是可确认对方服务器背后运营的企业是否真实存在。拥有该特性的证书就是 EV SSL证书（Extended Validation SSLCertificate）

EV SSL证书是基于国际标准的认证指导方针颁发的证书。其严格规定了对运营组织是否真实的确认方针，因此，通过认证的Web 网站能够获得更高的认可度。

持有 EV SSL证书的 Web 网站的浏览器地址栏处的背景色是绿色的，从视觉上就能一眼辨别出。而且在地址栏的左侧显示了 SSL证书中记录的组织名称以及颁发证书的认证机构的名称。

### <span id="jump8">**3. 用以确认客户端的客户端证书**</span>

HTTPS 中还可以使用客户端证书。以客户端证书进行客户端认证，证明服务器正在通信的对方始终是预料之内的客户端，其作用跟服务器证书如出一辙。但客户端证书仍存在几处问题点。其中的一个问题点是证书的获取及发布。想获取证书时，用户得自行安装客户端证书。但由于客户端证书是要付费购买的，且每张证书对应到每位用户也就意味着需支付和用户数对等的费用。另外，要让知识层次不同的用户们自行安装证书，这件事本身也充满了各种挑战。现状是，安全性极高的认证机构可颁发客户端证书但仅用于特殊用途的业务。比如那些可支撑客户端证书支出费用的业务。例如，银行的网上银行就采用了客户端证书。在登录网银时不仅要求用户确认输入 ID 和密码，还会要求用户的客户端证书，以确认用户是否从特定的终端访问网银。

客户端证书存在的另一个问题点是，客户端证书毕竟只能用来证明客户端实际存在，而不能用来证明用户本人的真实有效性。也就是说，只要获得了安装有客户端证书的计算机的使用权限，也就意味着同时拥有了客户端证书的使用权限。

### <span id="jump9">**4. 由自认证机构颁发的证书称为自签名证书**</span>

如果使用 OpenSSL这套开源程序，每个人都可以构建一套属于自己的认证机构，从而自己给自己颁发服务器证书。但该服务器证书在互联网上不可作为证书使用，似乎没什么帮助。
独立构建的认证机构叫做自认证机构，由自认证机构颁发的“无用”证书也被戏称为自签名证书。
浏览器访问该服务器时，会显示“无法确认连接安全性”或“该网站的安全证书存在问题”等警告消息。

由自认证机构颁发的服务器证书之所以不起作用，是因为它无法消除伪装的可能性。自认证机构能够产生的作用顶多也就是自己对外宣称“我是○○”的这种程度。即使采用自签名证书，通过 SSL加密之后，可能偶尔还会看见通信处在安全状态的提示，可那也是有问题的。因为 就算加密通信，也不能排除正在和已经过伪装的假服务器保持通信。值得信赖的第三方机构介入认证，才能让已植入在浏览器内的认证机构颁布的公开密钥发挥作用，并借此证明服务器的真实

# <span id="jumpd">**（四）HTTPS的安全通信机制**</span>

### <span id="jump10">**1. HTTPS 通信过程**</sapn>
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200501105647289.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjEyNDIxNA==,size_16,color_FFFFFF,t_70)

##### **（1）具体通信过程**：

- 客户端通过发送 Client Hello 报文**开始 SSL通信**。报文中包含客户端支持的 SSL的指定版本、加密组件（Cipher Suite）列表（所使用的加密算法及密钥长度等）。
- 服务器以 Server Hello 报文作为应答。和客户端一样，在报文中包含 SSL版本以及加密组件。服务器的加密组件内容是从接收到的客户端加密组件内筛选出来的。
- 之后服务器发送 Certificate 报文。报文中包含**公开密钥证书**。
- 最后服务器发送 Server Hello Done 报文通知客户端，**最初阶段的 SSL握手协商部分结束**。
- **SSL第一次握手结束之后**，客户端以 Client Key Exchange 报文作为回应。报文中包含通信加密中使用的一种被称为 Pre-mastersecret 的随机密码串。该报文已用步骤 3 中的公开密钥进行加密。
- 接着客户端继续发送 Change Cipher Spec 报文。该报文会提示服务器，在此报文之后的通信会采用 Pre-master secret 密钥加密。
- 客户端发送 Finished 报文。该报文包含连接至今全部报文的整体校验值。这次握手协商是否能够成功，要以服务器是否能够正确解密该报文作为判定标准。
- 服务器发送 Change Cipher Spec 报文。
- 服务器发送 Finished 报文。
- 服务器和客户端的 Finished 报文交换完毕之后，**SSL连接就算建立完成**。当然，通信会受到 SSL的保护。从此处开始进行应用层协议的通信，即发送 HTTP 请求。
-  应用层协议通信，即发送 HTTP 响应。
- 最后由客户端断开连接。断开连接时，发送 close_notify 报文。

上图做了一些省略，这步之后再发送 TCP FIN 报文来关闭与 TCP的通信。

在以上流程中，应用层发送数据时会附加一种叫做 MAC（MessageAuthentication Code）的报文摘要。MAC 能够查知报文是否遭到篡改，从而保护报文的完整性。

下面是对整个流程的图解。图中说明了从仅使用服务器端的公开密钥证书（服务器证书）建立 HTTPS 通信的整个过程。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200501105722948.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjEyNDIxNA==,size_16,color_FFFFFF,t_70)
如果上面的步骤记不住，那可以参考下面这种相对简要的HTTPS通信过程步骤：

##### <span id="jump11">（2）简要通信过程：</span>

- 客户使用https的URL访问Web服务器，要求与Web服务器建立SSL连接。

- Web服务器收到客户端请求后，会将网站的证书信息（证书中包含公钥）传送一份给客户端。

- 客户端的浏览器与Web服务器开始协商SSL/TLS连接的安全等级，也就是信息加密的等级。

- 客户端的浏览器根据双方同意的安全等级，建立会话密钥，然后利用网站的公钥将会话密钥加密，并传送给网站。

- Web服务器利用自己的私钥解密出会话密钥。

- Web服务器利用会话密钥加密与客户端之间的通信。

##### <span id="jump12">（3）不一直使用 HTTPS的原因</span>

其中一个原因是，因为与纯文本通信相比，加密通信会消耗更多的CPU 及内存资源。如果每次通信都加密，会消耗相当多的资源，平摊到一台计算机上时，能够处理的请求数量必定也会随之减少。
因此，如果是非敏感信息则使用 HTTP 通信，只有在包含个人信息等敏感数据时，才利用 HTTPS 加密通信。
特别是每当那些访问量较多的 Web 网站在进行加密处理时，它们所承担着的负载不容小觑。在进行加密处理时，并非对所有内容都进行加密处理，而是仅在那些需要信息隐藏时才会加密，以节约资源。

### <span id="jump13">**2. SSL 和 TLS**</span>

HTTPS 使用 SSL（Secure Socket Layer） 和 TLS（Transport LayerSecurity）这两个协议。

SSL技术最初是由浏览器开发商网景通信公司率先倡导的，开发过 SSL3.0 之前的版本。目前主导权已转移到 IETF（InternetEngineering Task Force，Internet 工程任务组）的手中。
IETF 以 SSL3.0 为基准，后又制定了 TLS1.0、TLS1.1 和TLS1.2。TSL是以 SSL为原型开发的协议，有时会统一称该协议为 SSL。
由于 SSL1.0 协议在设计之初被发现出了问题，就没有实际投入使用。SSL2.0 也被发现存在问题，所以很多浏览器直接废除了该协议版本。当前主流的版本是 SSL3.0 和 TLS1.0。

##### **（1）SSL握手**：

SSL握手过程其实已经包含在上面的HTTPS通信过程中了。下面就再单独说明其握手过程：

- 客户端发送 Client Hello 报文**开始 SSL通信**。

  报文中包含客户端支持的 SSL的指定版本、加密组件（Cipher Suite）列表（所使用的加密算法及密钥长度等）。

- 服务器以 Server Hello 报文作为应答。和客户端一样，在报文中包含 SSL版本以及加密组件。

- 服务器发送 Certificate 报文。报文中包含**公开密钥证书**。

- 最后服务器发送 Server Hello Done 报文通知客户端。

- 客户端以 Client Key Exchange 报文作为回应。

  报文中包含通信加密中使用的一种被称为 Pre-mastersecret 的随机密码串。该报文已用步骤 3 中的公开密钥进行加密。

- 客户端继续发送 Change Cipher Spec 报文。该报文会提示服务器，在此报文之后的通信会采用 Pre-master secret 密钥加密。

- 客户端发送 Finished 报文。

- 服务器发送 Change Cipher Spec 报文。

- 服务器发送 Finished 报文。

**SSL连接就算建立完成**。

##### <span id="jump14">**（2）SSL速度慢的原因**</span>

HTTPS 也存在一些问题，那就是当使用 SSL时，它的处理速度会变慢。HTTPS 比 HTTP 要慢 2 到 100 倍。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200501105755854.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjEyNDIxNA==,size_16,color_FFFFFF,t_70)

**SSL的慢分两种**：

- 一种是通信慢。
- 另一种是指由于大量消耗CPU 及内存等资源，导致处理速度变慢。

和使用 HTTP 相比，网络负载可能会变慢 2 到 100 倍。除去和TCP 连接、发送 HTTP 请求 • 响应以外，还必须进行 SSL通信，因此整体上处理通信量不可避免会增加。另一点是 SSL必须进行加密处理。在服务器和客户端都需要进行加密和解密的运算处理。

因此从结果上讲，比起 HTTP 会更多地消耗服务器和客户端的硬件资源，导致负载增强。针对速度变慢这一问题，并没有根本性的解决方案，我们会使用SSL加速器这种（专用服务器）硬件来改善该问题。该硬件为SSL通信专用硬件，相对软件来讲，能够提高数倍 SSL的计算速度。仅在 SSL处理时发挥 SSL加速器的功效，以分担负

## <span id="jumpe">**（五）HTTP 和 HTTPS的区别**</span>

- HTTPS协议需要到ca申请证书，一般免费证书很少，需要交费。  
- HTTP是超文本传输协议，信息是明文传输，HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议， 要比HTTP协议安全。
-  HTTP和HTTPS使用的是完全不同的连接方式用的端口也不一样,前者是80,后者是443。 
-  HTTP的连接很简单,是无状态的 。 



**注**：此文为阅读《图解HTTP》第七章 后规划整理的学习笔记。